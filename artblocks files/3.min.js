function roundPatch(e,t=v_rel(.5,.5),a){print("round patch");let n=[];return n=getEllipse(e*R.random(.8,1.2)*threadSize,e*R.random(.8,1.2)*threadSize,45),n.forEach(e=>e.mult(R.random(.8,2))),n.forEach(e=>e.add(t)),n=makeCurve(n),makePatch(n,a)}function rectPatch(e){print("rect patch");const t=new SquarePatternShape(R.random(baseWidth),R.random(baseWidth),R.random(100,600),R.random(100,600));return t.rotate(R.random(-15,15)),ps=t.ps,makePatch(ps,e)}function makePatch(e,t){const a=new LayoutPattern2(e),n=new Denim(a,t,0).rotate(R.random(360)).calc();applyPatchShadow(n);const o=patchStitches(n),r=R.random_dec()<.5;return{denim:n,stitches:o,fringe:r}}function applyPatchShadow(e){innerPattern=new LayoutPattern2(e.layoutPattern.getOffset(-3*globalScale)),innerPattern.ps.forEach(e=>e.add(5*globalScale,5*globalScale)),innerPattern.makeCurve();const t=createGraphics(width,height);t.background(255),t.noStroke(),t.fill(0),t.beginShape(),innerPattern.getCurve().forEach(e=>t.vertex(e.x,e.y)),t.endShape(),t.filter(BLUR,10*globalScale),e.weft.forEach(e=>{e.forEach(e=>{if(e.ps.length>0){const a=e.ps[0],n=t.get(a.x,a.y);brightness(n)<360&&(e.darkness=brightness(n)/1500)}})})}function applyPatch3dEffect(e,t){innerPattern=new LayoutPattern2(e.layoutPattern.getOffset(0)),innerPattern.ps.forEach(e=>e.add(5,5)),innerPattern.makeCurve();const a=createGraphics(width,height);a.background(0),a.noStroke(),a.fill(255,20),innerPattern.getCurve().forEach(e=>a.circle(e.x,e.y,R.random(50))),innerPattern.getCurve().forEach(e=>a.circle(e.x,e.y,R.random(30))),innerPattern.getCurve().forEach(e=>a.circle(e.x,e.y,R.random(10))),t.weft.forEach(e=>{e.forEach(e=>{if(e.ps.length>0){const t=e.ps[0],n=a.get(t.x,t.y);brightness(n)<360&&(e.age=brightness(n)/1500)}})})}function patchStitches(e){threadSize=initialThreadSize;let t=[];const a=R.random_choice([1,2,3]);if(1==a)t=crossStitches(e.layoutPattern,R.random(2,8),[35,3,3,3]);else if(2==a){if(t=e.layoutPattern.stitches(6,5,5,!0),R.random_dec()<.5&&(t=t.concat(e.layoutPattern.stitches(7,5,5,!0))),R.random_dec()<.4)for(let a=1;a<R.random(3);a++)t=t.concat(e.layoutPattern.stitches(6+R.random(5,40),5,5,!0))}else 3==a&&(t=e.layoutPattern.stitches(-6,5,5,!0),R.random_dec()<.5&&(t=t.concat(e.layoutPattern.stitches(-7,5,5,!0))),R.random_dec()<.7&&(t=t.concat(e.layoutPattern.stitches(-3,5,5,!0))));return t}async function drawStitches(e){for(const t of e)await new Loop(t,patchStitchColor,1.4*initialThreadSize).wiggle().shadow().draw(),await timeout(0)}function crossStitches(e,t,a){let n=[...e.ps];n.push(e.ps[0]),n=makeCurve(n);const o=[];for(let e=0;e<n.length;e+=a.rotate())o.push(n[e]);e.ps=o;const r=e.getOffset(t),i=e.getOffset(-t),d=[];for(let e=0;e<r.length;e++)r[e].add(R.random(-2,2),R.random(-2,2)),i[e].add(R.random(-2,2),R.random(-2,2)),d.push([r[e],i[e]]);return d}async function patches(){pattern=new SquarePatternShape(0,0,baseWidth,baseHeight),denim=new Denim(pattern,denimColor).rotate(R.random(360));const e=R.random_dec()<.5,t=R.random_dec()<.8?1:R.random(3),a=[];for(let e=0;e<t;e++)R.random_dec()<.5?a.push(roundPatch(baseWidth*R.random(.1,.25),v_rel(R.random(.2,.8),R.random(.2,.8)),denimColor)):a.push(rectPatch(denimColor));denim.calc().makeRips(),applyColorFunc(denim,globalColorFunc);for(let e=0;e<a.length;e++)applyPatch3dEffect(a[e].denim,denim);background(BG),await denim.draw({dontFringe:e});for(let e=0;e<a.length;e++)await a[e].denim.draw({dontFringe:a.fringe}),await drawStitches(a[e].stitches)}async function largeRips(){print("composition - large rips"),pattern=new SquarePatternShape(0,0,baseWidth,baseHeight),denim=new Denim(pattern,neighborColor(denimColor,0,0,-150)).rotate(R.random(360)),denim.visibleWhite=1,denim.darkness=.3,denim.calc(),denim2=new Denim(pattern,denimColor).rotate(R.random(360)),ripNoiseScale=[R.random(4,8),R.random(4,8)],denim2.ripThreshold=R.random(.3,.5),denim2.calc().makeRips(),applyColorFunc(denim2,globalColorFunc),denim2.dropShadowOn([denim]),background(BG),await denim.draw({dontFringe:!0}),await denim2.draw()}async function withDivide(){const e=R.random()<.5,t=R.random()<.5,a=R.random()<.5;let n,o;pattern_bg=new SquarePatternShape(0,0,baseWidth,baseHeight),denim_bg=new Denim(pattern_bg,denimColor).rotate(R.random(360)).calc(),a?(n=v(.2*-baseWidth,baseHeight*R.random(.3,.7)),o=v(1.2*baseWidth,baseHeight*R.random(.3,.7))):(n=v(baseWidth*R.random(.3,.7),.2*-baseHeight),o=v(baseWidth*R.random(.3,.7),1.2*baseHeight));const r=R.random()<.5?R.random(2,5):1,i=p5.Vector.sub(o,n).div(r),d=[];for(let e=1;e<r+1;e++){const t=p5.Vector.lerp(n,o,e/r);t.add(i.copy().rotate(90).mult(R.random(-.2,.2))),d.push(t)}let c,s;a?R.random()<.5?(c=v(.2*-baseWidth,.2*-baseHeight),s=v(1.2*baseWidth,.2*-baseHeight)):(c=v(.2*-baseWidth,1.2*baseHeight),s=v(1.2*baseWidth,1.2*baseHeight)):R.random()<.5?(c=v(.2*-baseWidth,.2*-baseHeight),s=v(.2*-baseWidth,1.2*baseHeight)):(c=v(1.2*baseWidth,.2*-baseHeight),s=v(1.2*baseWidth,1.2*baseHeight));const h=[c,n,...d,o,s];pattern_top=new LayoutPattern2(h).fillet(50),denim_top=new Denim(pattern_top,denimColor).rotate(R.random(-360)),e&&(denim_top.visibleWhite=1),denim_top.age=.2,denim_top.ripThreshold=R.random(.1,.45),denim_top.calc().makeRips(),applyColorFunc(denim_bg,globalColorFunc),initColorFunc(),applyColorFunc(denim_top,globalColorFunc),denim_top.foldedStitchings(),denim_top.dropShadowOn([denim_bg]),t&&(denim_top.warpExtensions=[R.random(10,50),R.random(50,200)],denim_top.extendChance=R.random(.7,1)),background(BG),await denim_bg.draw({dontFringe:!0}),await denim_top.draw({dontFringe:!1})}function setup(){noiseSeed(R.random_int(2e4)),1.4*windowWidth>windowHeight?canvas=createCanvas(windowHeight/1.4,windowHeight):canvas=createCanvas(windowWidth,1.4*windowWidth),globalScale=width/baseWidth,angleMode(DEGREES),noLoop(),noStroke(),noFill(),ripNoiseScale=[R.random(5,10),R.random(5,10)],initialThreadSize=R.random(2.5,3.5),threadSize=initialThreadSize;const e=new Date,t=e.getFullYear()-2023,a=t+e.getMonth()/12;globalAge=constrain(a/10,0,1),makeImage()}async function makeImage(){background(BG),fill(255),textSize(10),textAlign(CENTER,CENTER),text("Loading Jenim",width/2,height/2),noFill(),await timeout(30),initDenimParams(),initBaseColor(),initColorFunc();let e=R.random_choice(compositions);print(e.name),await e(),print("done")}const compositions=[withDivide,patches,largeRips],warpColors=natural;let stitchColor;const BG="#666",baseWidth=1e3,baseHeight=1.4*baseWidth;let globalScale;